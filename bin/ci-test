#!/bin/bash
# Local CI testing script

echo "🧪 Running local CI tests..."

# Test 1: Bundle install
echo "📦 Testing bundle install..."
bundle install || exit 1

# Test 2: Database setup
echo "🗄️ Testing database setup..."
RAILS_ENV=test bundle exec rails db:create db:migrate || exit 1

# Test 3: JavaScript dependencies
echo "📦 Testing yarn install..."
yarn install || exit 1

# Test 4: Asset compilation
echo "🎨 Testing asset compilation..."
RAILS_ENV=test bundle exec rails assets:precompile || exit 1

# Test 5: Rubocop tests
echo "🧪 Running Rubocop..."
bundle exec rubocop || exit 1

# Test 5: RSpec tests
echo "🧪 Running RSpec tests..."
bundle exec rspec || exit 1

# Test 6: Security scans
echo "🔒 Running security scans..."
bundle exec brakeman --quiet || exit 1
bundle exec bundler-audit check || exit 1

echo "✅ All local CI tests passed!"
